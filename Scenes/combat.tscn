[gd_scene load_steps=15 format=3 uid="uid://d3naap4gnytxh"]

[ext_resource type="Script" uid="uid://b0h0tx4msve02" path="res://scripts/Combat/combat_manager.gd" id="1_4ln8h"]
[ext_resource type="Resource" uid="uid://b01ucdggd8ykf" path="res://Resources/puyo_value_data.tres" id="2_xisnc"]
[ext_resource type="Texture2D" uid="uid://brsfj1k05k7e7" path="res://Art/combat_background.png" id="2_yt1oa"]
[ext_resource type="PackedScene" uid="uid://buetvmo3m42v5" path="res://Scenes/PuyoPuyo/puyo_manager.tscn" id="4_ubpar"]
[ext_resource type="PackedScene" uid="uid://dh8e8u4ch381l" path="res://Scenes/Combat/player.tscn" id="5_ut0kg"]
[ext_resource type="PackedScene" uid="uid://1hbj1uv66mu2" path="res://Scenes/DevTools/puyo_test_ui.tscn" id="5_yt1oa"]
[ext_resource type="Texture2D" uid="uid://14ejxpdanarl" path="res://Art/combat_frame.png" id="7_3w34b"]
[ext_resource type="PackedScene" uid="uid://cuj4wx1wkdopv" path="res://Scenes/Combat/Encounters/single_grunt_encounter.tscn" id="8_8xcd4"]
[ext_resource type="Script" uid="uid://b4hbt6qjcu26g" path="res://scripts/Combat/encounter_manager.gd" id="8_twsak"]
[ext_resource type="PackedScene" uid="uid://b3qfdcqaqmgk4" path="res://Scenes/Combat/combat_effects_manager.tscn" id="11_w6tjk"]
[ext_resource type="PackedScene" uid="uid://b2l1xn5ovaca4" path="res://Scenes/RewardScreen/reward_screen.tscn" id="11_xisnc"]
[ext_resource type="Script" uid="uid://bc5i4sjlttc78" path="res://scripts/Inventory.gd" id="12_xisnc"]
[ext_resource type="PackedScene" uid="uid://chmradttgb2ep" path="res://Scenes/Combat/life_counter.tscn" id="13_y8jr2"]
[ext_resource type="PackedScene" uid="uid://c5du1g626to65" path="res://Scenes/RewardScreen/equipped_spells_container.tscn" id="14_8xcd4"]

[node name="Combat" type="Node2D"]
script = ExtResource("1_4ln8h")
puyo_values = ExtResource("2_xisnc")

[node name="Background" type="CanvasLayer" parent="."]
layer = -1

[node name="TextureRect" type="TextureRect" parent="Background"]
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
texture = ExtResource("2_yt1oa")

[node name="Frame" type="CanvasLayer" parent="."]
layer = 2

[node name="TextureRect" type="TextureRect" parent="Frame"]
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
texture = ExtResource("7_3w34b")
expand_mode = 1

[node name="PuyoManager" parent="." instance=ExtResource("4_ubpar")]
position = Vector2(123, 128)
scale = Vector2(1.09, 1.09)

[node name="Player" parent="." instance=ExtResource("5_ut0kg")]

[node name="EncounterManager" type="Node2D" parent="."]
position = Vector2(823, 250)
script = ExtResource("8_twsak")
encounter_array = Array[PackedScene]([ExtResource("8_8xcd4")])

[node name="CombatEffectsManager" parent="." instance=ExtResource("11_w6tjk")]

[node name="PlayerLocation" parent="CombatEffectsManager" index="0"]
position = Vector2(690, 585)

[node name="EnemyLocation" parent="CombatEffectsManager" index="1"]
position = Vector2(824, 248)

[node name="PuyoTestUI" parent="." node_paths=PackedStringArray("puyo_manager") instance=ExtResource("5_yt1oa")]
layer = 2
visible = false
puyo_manager = NodePath("../PuyoManager")

[node name="RewardScreen" parent="." instance=ExtResource("11_xisnc")]
layer = 3
visible = false

[node name="Inventory" type="Node2D" parent="."]
script = ExtResource("12_xisnc")

[node name="LifeCounter" parent="." instance=ExtResource("13_y8jr2")]

[node name="EquippedSpellsContainer" parent="." instance=ExtResource("14_8xcd4")]

[connection signal="on_combat_started" from="." to="PuyoManager" method="reset_game"]
[connection signal="on_combat_started" from="." to="EncounterManager" method="load_next_encounter"]
[connection signal="on_counter_gained" from="." to="Player" method="add_counter"]
[connection signal="on_encounter_finished" from="." to="EncounterManager" method="check_for_rest_stop"]
[connection signal="on_enemy_attack" from="." to="Player" method="receive_attack"]
[connection signal="on_shield_gained" from="." to="Player" method="add_shield"]
[connection signal="block_popped" from="PuyoManager" to="CombatEffectsManager" method="create_player_attack_effect"]
[connection signal="block_popped" from="PuyoManager" to="EquippedSpellsContainer" method="block_spell_check"]
[connection signal="life_lost" from="PuyoManager" to="Player" method="lose_life"]
[connection signal="on_end_player_turn" from="PuyoManager" to="." method="end_player_turn"]
[connection signal="player_attack" from="PuyoManager" to="." method="process_player_attack"]
[connection signal="on_counter_triggered" from="Player" to="." method="trigger_counter"]
[connection signal="on_life_gain" from="Player" to="LifeCounter" method="gain_a_life"]
[connection signal="on_life_lost" from="Player" to="." method="lose_player_life"]
[connection signal="on_life_lost" from="Player" to="PuyoManager" method="reset_game"]
[connection signal="on_life_lost" from="Player" to="LifeCounter" method="lose_a_life"]
[connection signal="on_player_damage_taken" from="Player" to="PuyoManager" method="process_damage_taken"]
[connection signal="on_set_life_to" from="Player" to="LifeCounter" method="set_lives_to"]
[connection signal="on_rest_stop" from="EncounterManager" to="PuyoManager" method="pause_puyo"]
[connection signal="on_rest_stop" from="EncounterManager" to="RewardScreen" method="generate_pool"]
[connection signal="on_update_encounter" from="EncounterManager" to="." method="process_encounter_updated"]
[connection signal="start_game" from="PuyoTestUI" to="." method="start_combat"]
[connection signal="on_reward_chosen" from="RewardScreen" to="Inventory" method="add_to_inventory"]
[connection signal="restart_combat_after_reward" from="RewardScreen" to="." method="start_combat"]

[editable path="CombatEffectsManager"]
